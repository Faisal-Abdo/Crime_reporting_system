<!DOCTYPE html>
<html>
  <head>
    <title>CRS</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link rel="stylesheet" href="map.css" />
    <link rel="stylesheet" href="Style.css" />

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>

  <body>
    <div class="topBar">
      <div
        style="
          color: white;
          padding: 1.5% 2%;
          margin: 0;
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <div style="display: flex; align-items: center; gap: 10px">
          <div class="crime-report-icon">
            <div class="icon-shield"></div>
            <div class="icon-exclamation"></div>
          </div>
          <span>
            <h2>Crime Reporting System</h2>
          </span>
        </div>
        <h3 style="color: white; text-decoration: underline">Dashboard</h3>
      </div>
    </div>

    <p class="p_quote">
      <q class="quote">Unmasking Crimes, One Click at a Time</q>
    </p>

    <div id="map"></div>

    <script>
      var map = L.map("map");
      map.setView([51.505, -0.09], 13);

      L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);

      function addMarkerandPopup(
            lat,
            long,
            report_details,
            crime_type,
            date_time, 
            status
          ) {
            L.marker([lat, long]).addTo(map).bindPopup(`
                    <b>Crime info:</b><br>
                    <p>
                      Crime Type: ${crime_type}<br>
                      Report Details: ${report_details}<br>
                      Report Date and Time: ${date_time}<br>
                      Report Status: ${status}<br>
                    </p>`)
                    .openPopup();
          }

      fetch("/data.json")
        .then((response) => {
          if (!response.ok) {
            throw new Error(response.statusText);
          }
          return response.json();
        })
        .then((data) => {
          console.log(data.crimes);
          const crimes = data.crimes;
          crimes.forEach((crime) => {
            addMarkerandPopup(
              crime.latitude,
              crime.longitude,
              crime.report_details,
              crime.crime_type,
              crime.report_date_time,
              crime.report_status
            );
          });

        })
        .catch((error) => console.error(error));
    </script>
  </body>
</html>
